#
# hologram.py file for holographic machine learning program
#


import scipy as sp

# spherical Hankel functions of the first kind
def spherical_hn1(n,z,derivative=False):
    """ Spherical Hankel Function of the First Kind """
    return sp.special.spherical_jn(n,z,derivative=False) + 1j*sp.special.spherical_yn(n,z,derivative=False)

# given a set of points parametrized by r,t,p, this function returns the
# coefficient of Ylm in the spherical harmonic expansion of the electric
# field caused by these points at the surface of a sphere of radius r_h
def hologram_coeff_lm(r,t,p,r_h,k,l,m):

    # check input dimensions of arrays
    if (np.array(r1).shape != np.array(t1).shape or
        np.array(t1).shape != np.array(p1).shape):
        print('Error: input arrays do not have same shape')

    # determine r_lesser and r_greater
    r_lesser = np.inimum(r,r_h)
    r_greater = np.maximum(r,r_h)

    # compute factors in the spherical wave expansion
    j = sp.spherical_jn(l,k*r_lesser)
    h = spherical_hn1(l,k*r_greater)
    y = np.conj(sp.special.sph_harm(m,l,p,t)

    # assemble coefficients
    coeffs = np.exp(1j*np.array(r)) * k * 1j * j * h * y

    return np.sum(coeffs,axis=-1)
    
